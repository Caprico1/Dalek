import shodan
from config import get_api_key

def query_exploits(api_key, search_term):
    api = shodan.Shodan(api_key)

    results = api.exploits.search(query=search_term)

    print("Total: {}".format(results['total']))

    for match in results['matches']:
        print("\nID: {}\n".format(match['_id']))
        print("\nDescription: \n\n{}\n".format(match['description']))

        if 'match' in match.keys():
            print("\nCVE: {}\n".format(match['cve']))

        if 'author' in match.keys():
            print("\nAuthor: {}\n".format(match['author']))

        if 'platform' in match.keys():
            print("\nPlatform: {}\n".format(match['platform']))

        if 'port' in match.keys():
            print("\nAffected Port(s): {}\n".format(match['port']))

        if 'type' in match.keys():
            print("\nExploit Type: {}\n".format(match['type']))
        if 'code' in match.keys():
            print("\nCode: {}\n".format(match['code']))

        if 'msb' in match.keys():
            if len(match['msb']) != 0:
                print("\nMSB: {}\n".format(match['msb']))

        if 'source' in match.keys():
            print("\nSource(s): {}\n".format(match['source']))



if __name__ == '__main__':
    results = query_exploits(get_api_key(),"SMB")

    print(results)
    main()
