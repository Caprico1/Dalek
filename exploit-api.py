import shodan
from config import get_api_key

def query_exploits(api_key, search_term):
    api = shodan.Shodan(api_key)

    results = api.exploits.search(query=search_term)

    print("Total: {}".format(results['total']))

    for match in results['matches']:
        print(match)
        print("\nID: {}\n".format(match['_id']))
        print("\nDescription: \n\n{}\n".format(match['description']))

        if match['cve'] is not None:
            print("\nCVE: {}\n".format(match['cve']))

        if 'code' in match.keys():
            print("\nCode: {}\n".format(match['code']))




if __name__ == '__main__':
    results = query_exploits(get_api_key(),"SMB")

    print(results)
    main()
